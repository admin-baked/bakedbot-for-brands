{
  "entities": {
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available in the menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the product."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Detailed description of the product."
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "imageUrl",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the category."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the BakedBot AI Assistant.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "username": {
          "type": "string",
          "description": "Username of the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        }
      },
      "required": [
        "id",
        "username",
        "email"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents an order placed by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order)"
        },
        "orderDate": {
          "type": "string",
          "description": "Date and time the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        }
      },
      "required": [
        "id",
        "userId",
        "orderDate",
        "totalAmount"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the order item."
        },
        "orderId": {
          "type": "string",
          "description": "Reference to Order. (Relationship: Order 1:N OrderItem)"
        },
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the product in the order item."
        }
      },
      "required": [
        "id",
        "orderId",
        "productId",
        "quantity",
        "price"
      ]
    },
    "Content": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Content",
      "type": "object",
      "description": "Represents content created by the AI, such as blog posts or articles.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the content."
        },
        "title": {
          "type": "string",
          "description": "Title of the content."
        },
        "body": {
          "type": "string",
          "description": "The actual content (e.g., blog post text)."
        },
        "contentType": {
          "type": "string",
          "description": "Type of content (e.g., 'blog post', 'article')."
        },
        "creationDate": {
          "type": "string",
          "description": "Date and time the content was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "title",
        "body",
        "contentType",
        "creationDate"
      ]
    },
    "UserInteraction": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserInteraction",
      "type": "object",
      "description": "Represents a user interaction with the AI assistant, useful for recommendations.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user interaction."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N UserInteraction)"
        },
        "interactionDate": {
          "type": "string",
          "description": "Date and time of the interaction.",
          "format": "date-time"
        },
        "query": {
          "type": "string",
          "description": "The user's query or input."
        },
        "recommendedProductIds": {
          "type": "array",
          "description": "References to Products recommended during this interaction. (Relationship: UserInteraction 1:N Product)",
          "items": {
            "type": "string"
          }
        }
      },
      "required": [
        "id",
        "userId",
        "interactionDate",
        "query"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. The {userId} is the Firebase Authentication UID.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier of the category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier of the product."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores order information, nested under the user who placed the order.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user who placed the order."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual items within an order, nested under the order. This enforces path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user who placed the order."
            },
            {
              "name": "orderId",
              "description": "The unique identifier of the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier of the order item."
            }
          ]
        }
      },
      {
        "path": "/content/{contentId}",
        "definition": {
          "entityName": "Content",
          "schema": {
            "$ref": "#/backend/entities/Content"
          },
          "description": "Stores AI-generated content.",
          "params": [
            {
              "name": "contentId",
              "description": "The unique identifier of the content."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/interactions/{interactionId}",
        "definition": {
          "entityName": "UserInteraction",
          "schema": {
            "$ref": "#/backend/entities/UserInteraction"
          },
          "description": "Stores user interactions with the AI assistant, nested under the user. This supports personalized recommendations.",
          "params": [
            {
              "name": "userId",
              "description": "The Firebase Authentication UID of the user who interacted with the AI assistant."
            },
            {
              "name": "interactionId",
              "description": "The unique identifier of the user interaction."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the BakedBot AI Assistant, a WordPress plugin that provides AI-powered product recommendations, menu generation, content creation, and order management integration. The structure emphasizes authorization independence, clarity, and scalability, following the principles of DBAC (Database-Based Access Control). It avoids hierarchical authorization dependencies by denormalizing data where necessary, ensuring that security rules can be simple and efficient.\n\nThe key structural decisions and their justifications are:\n\n*   **Users Collection (`/users/{userId}`):** Stores user profiles. This is the root for user-specific data.\n*   **Categories Collection (`/categories/{categoryId}`):** Stores product categories. No specific ownership required, so top-level collection.\n*   **Products Collection (`/products/{productId}`):** Stores product information. No specific ownership required, so top-level collection.  Includes a `categoryId` field to reference the category.\n*   **Orders Collection (`/users/{userId}/orders/{orderId}`):** Stores order information, nested under the user who placed the order.  This utilizes path-based ownership.\n*   **OrderItems Collection (`/users/{userId}/orders/{orderId}/orderItems/{orderItemId}`):** Stores individual items within an order, nested under the order.  This continues path-based ownership for nested data. This ensures that only the user who placed the order can access the order items.\n*   **Content Collection (`/content/{contentId}`):** Stores AI-generated content. No specific ownership required, so top-level collection.\n*   **UserInteractions Collection (`/users/{userId}/interactions/{interactionId}`):** Stores user interactions with the AI assistant, nested under the user. This supports personalized recommendations and utilizes path-based ownership.\n\nThis structure achieves **Authorization Independence** by:\n\n*   Using path-based ownership for user-specific data (orders, order items, and user interactions). This eliminates the need to `get()` parent documents to validate access, because security rules can rely solely on `request.auth.uid` and the path.\n\nThe structure supports the required **QAPs (Rules are not Filters)** by:\n\n*   Segregating data with different access needs into separate collections and subcollections.\n*   Utilizing path-based ownership for user-specific data, making it easy to secure list operations."
  }
}