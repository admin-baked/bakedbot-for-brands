
{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the BakedBot AI Assistant plugin.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "googleId": {
          "type": "string",
          "description": "User's Google ID for Google Login."
        },
        "magicButtonToken": {
          "type": "string",
          "description": "Token for Magic Button authentication."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "User's first name."
        },
        "lastName": {
          "type": "string",
          "description": "User's last name."
        }
      },
      "required": [
        "id"
      ]
    },
    "UserPrivate": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "UserPrivate",
      "type": "object",
      "description": "Represents private user data, such as API keys.",
      "properties": {
        "bakedBotApiKey": {
          "type": "string",
          "description": "The user's API key for the BakedBot service."
        }
      }
    },
    "Product": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Product",
      "type": "object",
      "description": "Represents a product available in the menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Product entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the product."
        },
        "description": {
          "type": "string",
          "description": "Description of the product."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the product image.",
          "format": "uri"
        },
        "price": {
          "type": "number",
          "description": "Price of the product."
        },
        "categoryId": {
          "type": "string",
          "description": "Reference to Category. (Relationship: Category 1:N Product)"
        },
        "likes": {
          "type": "number",
          "description": "The number of likes a product has received."
        },
        "dislikes": {
          "type": "number",
          "description": "The number of dislikes a product has received."
        }
      },
      "required": [
        "id",
        "name",
        "description",
        "price",
        "categoryId"
      ]
    },
    "Category": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Category",
      "type": "object",
      "description": "Represents a category of products in the menu.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Category entity."
        },
        "name": {
          "type": "string",
          "description": "Name of the category."
        },
        "description": {
          "type": "string",
          "description": "Description of the category."
        },
        "imageUrl": {
          "type": "string",
          "description": "URL of the category image.",
          "format": "uri"
        }
      },
      "required": [
        "id",
        "name",
        "description"
      ]
    },
    "Order": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Order",
      "type": "object",
      "description": "Represents a customer order.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Order). Can be 'guest' for anonymous checkouts."
        },
        "customerName": {
            "type": "string",
            "description": "Full name of the customer placing the order."
        },
        "customerPhone": {
            "type": "string",
            "description": "Phone number of the customer."
        },
        "locationId": {
            "type": "string",
            "description": "The ID of the dispensary location for pickup."
        },
        "orderDate": {
          "type": "string",
          "description": "Date the order was placed.",
          "format": "date-time"
        },
        "totalAmount": {
          "type": "number",
          "description": "Total amount of the order."
        },
        "status": {
            "type": "string",
            "enum": ["pending", "confirmed", "ready", "completed", "cancelled"],
            "description": "The current status of the order."
        }
      },
      "required": [
        "userId",
        "customerName",
        "customerPhone",
        "locationId",
        "orderDate",
        "totalAmount",
        "status"
      ]
    },
    "OrderItem": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "OrderItem",
      "type": "object",
      "description": "Represents an item within an order.",
      "properties": {
        "productId": {
          "type": "string",
          "description": "Reference to Product. (Relationship: Product 1:N OrderItem)"
        },
        "productName": {
            "type": "string",
            "description": "Name of the product at the time of order."
        },
        "quantity": {
          "type": "number",
          "description": "Quantity of the product in the order item."
        },
        "price": {
          "type": "number",
          "description": "Price of the item at the time of order."
        }
      },
      "required": [
        "productId",
        "productName",
        "quantity",
        "price"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a product review from a customer.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Review."
        },
        "productId": {
          "type": "string",
          "description": "The ID of the product being reviewed."
        },
        "userId": {
          "type": "string",
          "description": "The ID of the user submitting the review."
        },
        "rating": {
          "type": "number",
          "description": "Star rating from 1 to 5."
        },
        "text": {
          "type": "string",
          "description": "The written content of the review."
        },
        "verificationImageUrl": {
          "type": "string",
          "description": "URL of the uploaded receipt or COA image for verification.",
          "format": "uri"
        },
        "createdAt": {
            "type": "string",
            "description": "The timestamp when the review was created.",
            "format": "date-time"
        }
      },
      "required": [
        "id",
        "productId",
        "userId",
        "rating",
        "text"
      ]
    }
  },
  "auth": {
    "providers": [
      "google.com",
      "password",
      "emailLink"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. This path is readable by any authenticated user to allow displaying user information (like emails for reviews) but is only writable by the owner.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/user-private/{userId}",
        "definition": {
          "entityName": "UserPrivate",
          "schema": {
            "$ref": "#/backend/entities/UserPrivate"
          },
          "description": "Stores private user data, like API keys. Strictly owned by the user.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/categories/{categoryId}",
        "definition": {
          "entityName": "Category",
          "schema": {
            "$ref": "#/backend/entities/Category"
          },
          "description": "Stores product categories.",
          "params": [
            {
              "name": "categoryId",
              "description": "The unique identifier for the category."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}",
        "definition": {
          "entityName": "Product",
          "schema": {
            "$ref": "#/backend/entities/Product"
          },
          "description": "Stores product information.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            }
          ]
        }
      },
      {
        "path": "/products/{productId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Stores customer reviews for a specific product. The collection is queryable by authenticated users.",
          "params": [
            {
              "name": "productId",
              "description": "The unique identifier for the product."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}",
        "definition": {
          "entityName": "Order",
          "schema": {
            "$ref": "#/backend/entities/Order"
          },
          "description": "Stores user order history. This path ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/orders/{orderId}/orderItems/{orderItemId}",
        "definition": {
          "entityName": "OrderItem",
          "schema": {
            "$ref": "#/backend/entities/OrderItem"
          },
          "description": "Stores individual order items for an order. This path ensures path-based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "orderId",
              "description": "The unique identifier for the order."
            },
            {
              "name": "orderItemId",
              "description": "The unique identifier for the order item."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to support the BakedBot AI Assistant plugin, prioritizing security, scalability, and debuggability. User data is stored under `/users/{userId}` for public profile information, which is readable by any authenticated user to facilitate features like displaying reviewer emails. A separate `/user-private/{userId}` collection is added for sensitive data like API keys, with strict ownership rules. Categories and Products are stored as top-level collections, as they are not directly owned by users, with the product's category relationship expressed via the `categoryId` field. Orders and OrderItems follow a hierarchical path under users for ownership and data locality. Reviews are stored as a subcollection under each product to keep them organized and directly associated with the item they describe. This design enables atomic operations and facilitates secure list operations by segregating data based on ownership and type."
  }
}
