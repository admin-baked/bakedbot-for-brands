# Settings to manage and configure a Firebase App Hosting backend.
# https://firebase.google.com/docs/app-hosting/configure

env:
  # Build-time memory allocation - Reduced after extracting lead magnets
  # Using 20GB for V8 heap (reduced from 201 to ~175 pages)
  # Firebase build containers have ~32GB physical RAM
  - variable: NODE_OPTIONS
    value: "--max-old-space-size=20000"
    availability: [ BUILD ]
  - variable: NEXT_TELEMETRY_DISABLED
    value: "1"
    availability: [ BUILD ]
  # Disable Turbopack - use stable webpack bundler for production builds
  - variable: TURBO
    value: "0"
    availability: [ BUILD ]
  - variable: NEXT_EXPERIMENTAL_TURBOPACK
    value: "false"
    availability: [ BUILD ]
  - variable: __NEXT_EXPERIMENTAL_TURBOPACK
    value: "false"
    availability: [ BUILD ]
  # Runtime memory allocation - can be higher since we control runtime resources
  - variable: NODE_OPTIONS
    value: "--max-old-space-size=24576"
    availability: [ RUNTIME ]
  # Skip Next.js Node version check (Firebase App Hosting uses Node 18)
  - variable: NEXT_SKIP_NODE_VERSION_CHECK
    value: "1"
    availability: [ BUILD ]
  # Firebase
  - variable: FIREBASE_SERVICE_ACCOUNT_KEY
    secret: FIREBASE_SERVICE_ACCOUNT_KEY@8
    availability:
      - BUILD
      - RUNTIME
  # Email
  - variable: SENDGRID_API_KEY
    secret: SENDGRID_API_KEY@2
    availability:
      - RUNTIME
  - variable: SENDGRID_FROM_EMAIL
    value: "orders@bakedbot.ai"
    availability:
      - RUNTIME
  - variable: SENDGRID_FROM_NAME
    value: "BakedBot Orders"
    availability:
      - RUNTIME
  - variable: MAILJET_API_KEY
    secret: MAILJET_API_KEY
    availability:
      - RUNTIME
  - variable: MAILJET_SECRET_KEY
    secret: MAILJET_SECRET_KEY
    availability:
      - RUNTIME
  # Security
  # - variable: RECAPTCHA_SECRET_KEY
  #   secret: RECAPTCHA_SECRET_KEY
  #   availability:
  #     - RUNTIME
  # - variable: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
  #   secret: NEXT_PUBLIC_RECAPTCHA_SITE_KEY
  #   availability:
  #     - RUNTIME
  # CannMenus
  - variable: CANNMENUS_API_BASE
    value: "https://api.cannmenus.com"
    availability:
      - RUNTIME
  - variable: CANNMENUS_API_KEY
    secret: CANNMENUS_API_KEY@3
    availability:
      - RUNTIME
  # Authorize.Net
  - variable: AUTHNET_API_LOGIN_ID
    secret: AUTHNET_API_LOGIN_ID
    availability:
      - RUNTIME
  - variable: AUTHNET_TRANSACTION_KEY
    secret: AUTHNET_TRANSACTION_KEY
    availability:
      - RUNTIME
  # - variable: AUTHNET_SIGNATURE_KEY
  #   secret: AUTHNET_SIGNATURE_KEY
  #   availability:
  #     - RUNTIME
  - variable: AUTHNET_ENV
    value: "production"
    availability:
      - RUNTIME
  - variable: NEXT_PUBLIC_AUTHNET_ENV
    value: "production"
    availability:
      - BUILD
      - RUNTIME
  # - variable: NEXT_PUBLIC_AUTHNET_CLIENT_KEY
  #   secret: NEXT_PUBLIC_AUTHNET_CLIENT_KEY
  #   availability:
  #     - BUILD
  #     - RUNTIME
  - variable: NEXT_PUBLIC_AUTHNET_API_LOGIN_ID
    secret: AUTHNET_API_LOGIN_ID
    availability:
      - BUILD
      - RUNTIME
  # AI/Tools
  - variable: CLAUDE_API_KEY
    secret: CLAUDE_API_KEY
    availability:
      - RUNTIME
  - variable: GEMINI_API_KEY
    secret: GEMINI_API_KEY@5
    availability:
      - RUNTIME
  - variable: NEXT_PUBLIC_FIREBASE_API_KEY
    secret: NEXT_PUBLIC_FIREBASE_API_KEY@4
    availability:
      - RUNTIME
      - BUILD
  - variable: SERPER_API_KEY
    secret: SERPER_API_KEY@3
    availability:
      - RUNTIME
  - variable: OPENAI_VIDEO_API_KEY
    secret: OPENAI_VIDEO_API_KEY
    availability:
      - RUNTIME
  # Google OAuth
  - variable: GOOGLE_CLIENT_ID
    secret: GOOGLE_CLIENT_ID
    availability:
      - RUNTIME
  - variable: GOOGLE_CLIENT_SECRET
    secret: GOOGLE_CLIENT_SECRET
    availability:
      - RUNTIME
  # SMS
  # - variable: LEAFBUYER_API_KEY
  #   secret: LEAFBUYER_API_KEY
  #   availability:
  #     - RUNTIME
  # - variable: LEAFBUYER_API_SECRET
  #   secret: LEAFBUYER_API_SECRET
  #   availability:
  #     - RUNTIME
  - variable: CODE_RUNNER_URL
    value: "https://bakedbot-code-runner-lo74oftdza-uc.a.run.app"
    availability:
      - RUNTIME
  # - variable: LEAFBUYER_API_URL
  #   secret: LEAFBUYER_API_URL
  #   availability:
  #     - RUNTIME
  # - variable: BLACKLEAF_API_KEY
  #   secret: BLACKLEAF_API_KEY
  #   availability:
  #     - RUNTIME
  - variable: BLACKLEAF_BASE_URL
    value: "https://api.blackleaf.io"
    availability:
      - RUNTIME
  # CanPay
  - variable: CANPAY_MODE
    value: "sandbox"
    availability:
      - RUNTIME
  - variable: CANPAY_ENVIRONMENT
    value: "sandbox"
    availability:
      - RUNTIME
  - variable: CANPAY_APP_KEY
    secret: CANPAY_APP_KEY@1
    availability:
      - RUNTIME
  - variable: CANPAY_API_SECRET
    secret: CANPAY_API_SECRET@1
    availability:
      - RUNTIME
  - variable: CANPAY_INTEGRATOR_ID
    secret: CANPAY_INTEGRATOR_ID@1
    availability:
      - RUNTIME
  - variable: CANPAY_INTERNAL_VERSION
    value: "1.4.0"
    availability:
      - RUNTIME
  # Stripe
  # - variable: STRIPE_SECRET_KEY
  #   secret: STRIPE_SECRET_KEY
  #   availability:
  #     - RUNTIME
  # - variable: STRIPE_WEBHOOK_SECRET
  #   secret: STRIPE_WEBHOOK_SECRET
  #   availability:
  #     - RUNTIME
  # Monitoring
  # - variable: SENTRY_DSN
  #   secret: SENTRY_DSN
  #   availability:
  #     - RUNTIME
  # - variable: NEXT_PUBLIC_SENTRY_DSN
  #   secret: SENTRY_DSN
  #   availability:
  #     - RUNTIME
  # Dev/Security
  - variable: NEXT_PUBLIC_DEV_AUTH_BYPASS
    value: "false"
    availability:
      - RUNTIME
  - variable: CRON_SECRET
    secret: CRON_SECRET
    availability:
      - RUNTIME
  - variable: NEXT_PUBLIC_APP_URL
    value: "https://bakedbot-prod--studio-567050101-bc6e8.us-central1.hosted.app"
    availability:
      - RUNTIME
  # Treasury
  - variable: TREASURY_ENABLE_REAL_TRADING
    value: "false"
    availability:
      - RUNTIME
  - variable: TREASURY_USE_FIRESTORE
    value: "true"
    availability:
      - RUNTIME
  - variable: FIRECRAWL_API_KEY
    secret: FIRECRAWL_API_KEY
    availability:
      - RUNTIME
  # RTRVR - Browser Automation
  - variable: RTRVR_API_KEY
    secret: RTRVR_API_KEY
    availability:
      - RUNTIME
  # OpenClaw - WhatsApp Gateway
  - variable: OPENCLAW_API_URL
    secret: OPENCLAW_API_URL
    availability:
      - RUNTIME
  - variable: OPENCLAW_API_KEY
    secret: OPENCLAW_API_KEY
    availability:
      - RUNTIME
  - variable: LETTA_API_KEY
    secret: LETTA_API_KEY@1
    availability:
      - RUNTIME
  # Alleaves POS (Thrive Syracuse) - JWT Authentication
  - variable: ALLEAVES_USERNAME
    secret: ALLEAVES_USERNAME
    availability:
      - RUNTIME
  - variable: ALLEAVES_PASSWORD
    secret: ALLEAVES_PASSWORD
    availability:
      - RUNTIME
  - variable: ALLEAVES_PIN
    secret: ALLEAVES_PIN
    availability:
      - RUNTIME
  - variable: ALLEAVES_LOCATION_ID
    secret: ALLEAVES_LOCATION_ID
    availability:
      - RUNTIME


runConfig:
  minInstances: 0
  maxInstances: 10
  concurrency: 80
  cpu: 1
  memoryMiB: 2048  # Increased from 512MB - Next.js + AI features need more memory

build:
  installCommand: npm install --legacy-peer-deps
  buildCommand: npm run build:embed && npm run check:structure && next build --no-turbopack
